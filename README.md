# Framework - простой фреймворк на Python
### с примером его использования, включая микросервисное демо-приложение.

## Общая информация

Данные приложения и фреймворк реализованы в рамках курса по паттернам проектирования 
в объектно-ориентированных языках программирования для демонстрации применения таких паттернов 
при реализации фреймворка, аналогичного Flask и прочим, 
предоставляющим базовый функционал для быстрой разработки web-приложений.

В рамках разработки приложений не ставилось задачи 
запрограммировать исчерпывающую реализацию какой-либо функциональности. 
Напротив, в условиях ограниченного времени акцент ставился на реализации MVP (минимального жизнеспособного продукта),
с одной стороны, демонстрирующего требуемый по ТЗ функционал приложения, 
а с другой - показывающего эффективное применение паттернов проектирования для написания удобного в использовании, 
расширяемого по функциональности кода фреймворка, удовлетворяющего принципам DRY и прочим принятым в отрасли критериям 
"хорошего" кода.

### Фреймворк

Фреймворк реализует следующию функциональность (базовая реализация для демонстрации паттернов проектирования):
- Routing (маршрутизация) - распаковка и маршрутизация http-запросов (requests) по дереву ссылок (url) приложения, 
упаковка http-ответов (response) (framework.py, request.py, response.py).
- CBV (Class-Based Views, отображение информации с использованием классов) - дерево классов для обработки http-запросов 
и визуализации данных пользователя в web-приложениях с использованием шаблонизатора Jinja2 
и наследования шаблонов (views.py).
- ORM (Object-Relational Mapping, объектно-реляционное отображение данных) - библиотека для сохранения и загрузки 
объектов Python в хранилища данных; реализованы интерфейсы JSON и SQLite (persistence.py, persistence_sqlite.py).
- Logger (логирование) - библиотека, реализующая функциональность создания произвольного количества именованных логгеров 
и логирования в различные системы хранения и отображения логов; реализовано отображение на консоль и сохранение в файл. 

### Основное приложение

Основное приложение реализует минимальную функциональность административного интерфейса учебного портала:
создание/редактирование/удаление категорий учебных курсов, 
самих курсов с присвоением им категорий и студентов с регистрацией их на курс. 
Также доступна функциональность посылки пользователем сообщений обратной связи и просмотра таких сообщений.

### Микросервисное приложение

Микросервисное приложение предназначено для демонстрации концепции разделения монолитного приложения на микросервисы, 
способные к ограниченному самостоятельному функционированию в условиях отключения (сбоя) других (микро-)сервисов
системы. Оно реализует функциональность посылки пользователем сообщений обратной связи с сохранением их локально и
отправки их в основное приложение в случае его доступности. 

Данное приложение демонстрирует минимизацию фреймворком усилий программиста для разработки простейших web-приложений.


## Информация по использованию приложений

Перед запуском приложения установите необходимые библиотеки:

    pip install gunicorn, Jinja2, requests
    
### Основное приложение

Чтобы запустить приложение, наберите (в квадратных скобках - необязательный параметр): 
        
    gunicorn [-b 127.0.0.1:8000] app:app 

Для тестирования приложения в браузере на локальном компьютере наберите:

    http://127.0.0.1:8000
    
В левой боковой панели приложения реализовано меню навигации, 
где доступны ссылки на страницы с требуемой по ТЗ (ДЗ) и дополнительной функциональностью:

- Главная страница (/) - (view Index) список категорий курсов, курсов и студентов; 
при нажатии на названии категории/курса/имени студента или ссылке "Создать ..." в соответствующем столбце
осушествляется переход на страницу создания/редактирования/копирования/удаления 
категории (view ElementEditView)/курса (view CourseEditView)/студента (view StudentEditView).

- Обратная связь (/contact) - (view FeedbackView) страница обратной связи, 
где можно оставить сообщение и контактные данные.

- Блог (/feedback) - (view FeedbackListView) страница сообщений обратной связи, 
отсортированных в порядке от новых обращений к старым.

- Административный интерфейс (/admin) - (view Admin) административный интерфейс из фреймворка, 
демонстрирует детали объекта WSGI request и дает возможность тестирования запросов GET и POST 
с произвольными параметрами. 

### Демонстрационный микросервис

Чтобы запустить микросервисное мини-приложение, наберите:

    gunicorn -b 127.0.0.1:8001 app_student:app

Для тестирования приложения в браузере на локальном компьютере наберите:

    http://127.0.0.1:8001

#### Примерный сценарий тестирования совместного функционирования основного и микросервисного приложения

1. Запустите основное и микросервисное приложение, как это описано выше. 
Откройте интерфейсы приложений в браузере.
2. Создайте сообщение обратной связи с микросервисном приложении. 
В папке приложения app/contact_messages проверьте наличие и содержание нового сообщения.
3. В основном приложении в разделе "Блог" проверьте наличие и содержание нового сообщения,
которое было размещено там микросервисом.
4. В основном приложении в разделе "Обратная связь" создайте сообщение обратной связи 
и убедитесь, что оно появилось в разделе "Блог", но не появилось в папке app/contact_messages ,
куда пишет дубликат сообщения микросервисное приложение.


## Техническая информация

### Фреймворк

Детальная информация по фреймворку на английском языке доступна в файле CHANGES.md . 
Здесь приводится краткая обзорная информация.

Состав фреймворка (папка framework/):
- templates/ - папка с html-файлами фреймворка, в т.ч. страницей 404 и админки
- templates/baseview - папка с html-файлами класса BaseView (см. CHANGES.md от 28.03.2022)
- framework.py - класс Framework, чей объект вызывается как приложение gunicorn, 
а в init() передаются url пользовательского приложения;
он получает параметры запроса, маршрутизирует его в требуемый вью и возвращает результат его работы;
маршрутизация возможна как по полному url, так и по wildcard (например, /someurl/*); 
также реализован декоратор @url() для добавления вью в приложения (см. CHANGES.md от 07.04.2022), 
работа которого продемонстрирована в микросервисном приложении.
- logger.py - класс Logger и прочие классы, реализующие функциональность логгера
(см. CHANGES.md от 05.04.2022); также реализован декоратор @debug для логирования начала и конца выполнения методов 
(инициализации классов) (см. CHANGES.md от 07.04.2022)
- persistence.py - класс Persistence и прочие классы, реализующие функциональность элементарной СУБД с сохранением
данных в файл JSON и возможностью расширения списка СУБД (см. CHANGES.md от 14.04.2022 и 18.04.2022)
- persistence_sqlite.py - класс PersistenceSQLite, добавляющий функциональность сохранения данных в БД SQLite (sqlite3) 
в библиотеку persistence.py (см. CHANGES.md от 14.04.2022)
- request.py - класс Request, чей объект содержит параметры переданного wsgi сервером окружения
- response.py - класс Response, чей объект содержит результаты работы вью
- settings.py - некоторые константы общего пользования, которые не удалось распихать по классам
- singleton.py - абстрактный класс Singleton, реализующий одноименную функциональность 
- urls.py - класс Url для хранения информации для маршрутизации и объект urls с url админки
- views.py - класс View для всех вью проекта, а также некоторые служебные вью:
    - Minimal - для отображения информации без использования темплейтов на файловой системе с минимальными заголовками
    - Render - для отображения параметризованных шаблонов из файлов с использованием jinja2
    - View404 - для отображения дефолтной страницы кода 404
    - Admin - вью админки, отображающее параметры из окружения wsgi
    и дающее возможность тестирования запросов get и 
    классы иерархических темплейтов BaseView (см. CHANGES.md от 28.03.2022):
    - BaseViewSection - класс-перечисление разделов вью BaseView
    - BaseViewTagData - тэги jinja2 в файлах шаблонов и соответствующие им текущие данные - шаблоны и данные html - 
    для отображения в соответствующих разделах шаблонов страниц 
    - BaseViewLayout - класс-singleton, хранящий конфигурацию класса BaseView для использования им и всеми его 
    наследниками для отображения шаблонов; инициализируется шаблонами по умолчанию 
    из папки framework/template/baseview; имеет следующие открытые методы:
        - set_template() - установить пользовательский шаблон Jinja2 для указанного раздела базового шаблона; 
        шаблон будет обработан (render) обновременно с базовым шаблоном BaseView,
        - render_html_include() - обработать (render) шаблон Jinja2 немедленно и установить его 
        как статический текст html для указанного раздела базового шаблона.
    - BaseView - класс, используемый для отображения базового и включенных шаблонов BaseView.
    В CHANGES.md от 28.03.2022 даны примеры использования BaseView.

### Основное приложение

Состав приложения (корневая папка проекта):
- app.py - основной файл, где создается объект Framework и который используется для запуска приложения
- category.py - функционал категорий учебных курсов (см. CHANGES.md от 02.04.2022)
- course.py - функционал учебных курсов (см. CHANGES.md от 02.04.2022)
- element_edit.py - функционал шаблона редактирования записей данных (см. CHANGES.md от 02.04.2022)
- feedback.py - функционал обратной связи (см. CHANGES.md от 18.04.2022)
- logs.py - конфигурация логгера (см. CHANGES.md от 05.04.2022)
- miscellaneous.py - функции общего назначения, используемые в приложении. 
- settings.py - некоторые константы общего пользования, которые не удалось распихать по классам;
в частности, содержит путь к папке файлов html приложения
- student.py - функционал студентов (см. CHANGES.md от 16.04.2022)
- urls.py - объект app_urls с url приложения
- views.py - некоторые вью приложения:
    - Index - вью главной страницы
    
Все вью типового приложения используют систему иерархических темплейтов, реализованных классом BaseView.

### Демонстрационный микровервис

- app_student.py - основной файл, где создается объект Framework и который используется для запуска 
микросервисного приложения
    - Contact - вью для сообщений пользователя; файлы сообщений сохраняются в папке app/contact_messages
    (см. CHANGES.md от 28.03.2022 и 18.04.2022)
